{% extends 'base.html.twig' %}
{% block stylesheets %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <style>
        .error {
            display: none;
        }
        .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
        .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
    </style>
{% endblock %}

{% block title %}Hello /math::Calculator!{% endblock %}


{% block body %}
    <div class="example-wrapper">
        <h1>Hello and enjoy the equation below! âœ…</h1>
        {{ form(equation_form) }}
    </div>
{% endblock %}


{% block javascripts %}
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.js"></script>
    
    {{ parent() }}
    <script>
        {{ encore_entry_script_tags('app') }}
        
        const routeDefault = "{{ path('app_math')|escape('js') }}";
        const routeCalculate = "{{ path('app_math_calculate')|escape('js') }}";

        console.log(routeDefault);
        console.log(routeCalculate);

        var equationForm = $('form[id="equation_form"]');

        function validate() {
            var leftVal = $('#equation_form_leftOperand').val();
            var leftIsInteger = Number.isInteger(parseInt(leftVal));
            var rightVal = $('#equation_form_rightOperand').val();
            var rightIsInteger = Number.isInteger(parseInt(rightVal));
            var op = $('#equation_form_operator').val();

            if (leftIsInteger && rightIsInteger) {
                var data = {
                    left: leftVal,
                    right: rightVal,
                    op: op
                };
                console.log(data);

                $.ajax({
                    type: "POST",
                    url: routeCalculate,
                    data: data,
                    success: function (data) {
                        console.log(data);
                        $('#equation_form_result').val(data['result']);
                    },
                });
            }
            else {
                console.log('validation failed');
            }
        }
        $(document).ready(function () {
            validate();
            $('#equation_form_operator').on('change', function(e){
                validate();
            });
            $("input").change(function(){
                validate();
            });
        });
    </script>
{% endblock %}
